<!--Website born on 01-30-25
Initiated by Robert Stanley
Co-Authored by Luca Maddaleni & Sean Griffiths for Group Meshtacular in Computer Networks
Spring Semester 2025-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Meshtacular Project Website</title>
    <link rel="stylesheet" href="style.css">
    <!--sanitize content before display using DOMPurify-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.3/purify.min.js"></script> 
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Firebase Configuration - Load from environment variables securely
        // This will be populated at build time or runtime
        const firebaseConfig = {
            // These will be filled in from environment variables
            // DO NOT hardcode sensitive information here
        };

        // Initialize Firebase only if config is available
        let app, auth, db;
        
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        // Make auth and db available to other scripts
        window.firebaseAuth = auth;
        window.firebaseDb = db;
    </script>
</head>
<body>
    <header>
        <h1>üï∂Ô∏è Welcome to Group Meshtacular</h1>
        <p>üìü The Cyber HQ for Our Networking & Security Portfolio</p>
    </header>

    <!-- Authentication Section -->
    <section id="auth-section">
        <div class="auth-container">
            <div class="auth-form">
                <h2>Sign Up</h2>
                <form id="signup-form">
                    <input type="hidden" id="signup-csrf" name="_csrf">
                    <input type="email" id="signup-email" placeholder="Email" required>
                    <input type="password" id="signup-password" placeholder="Password" required>
                    <button type="submit">Sign Up</button>
                </form>
            </div>
            
            <div class="auth-form">
                <h2>Login</h2>
                <form id="login-form">
                    <input type="hidden" id="login-csrf" name="_csrf">
                    <input type="email" id="login-email" placeholder="Email" required>
                    <input type="password" id="login-password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Dashboard (Only visible after login) -->
    <section id="dashboard" style="display:none;">
        <h2>Welcome, <span id="user-email"></span>!</h2>
        
        <!-- Feedback Form -->
        <div class="feedback-container">
            <h3>Submit Feedback</h3>
            <form id="feedback-form">
                <input type="hidden" id="feedback-csrf" name="_csrf">
                <label for="feedback">Your Feedback:</label>
                <textarea id="feedback" name="feedback" required></textarea>
                <button type="submit">Submit Feedback</button>
            </form>
        </div>
        
        <!-- Feedback Messages -->
        <div class="feedback-display">
            <h3>Your Submitted Feedback</h3>
            <div id="feedback-messages"></div>
        </div>
        
        <button id="logout">Logout</button>
    </section>

    <!-- Firebase Authentication & Feedback Handling -->
    <script type="module">
        import { getFirestore, collection, addDoc, query, orderBy, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // Get references to the auth and db from the global scope
        const auth = window.firebaseAuth;
        const db = window.firebaseDb;

        // DOM Elements
        const authSection = document.getElementById("auth-section");
        const dashboard = document.getElementById("dashboard");
        const userEmailSpan = document.getElementById("user-email");
        const signupForm = document.getElementById("signup-form");
        const loginForm = document.getElementById("login-form");
        const feedbackForm = document.getElementById("feedback-form");
        const feedbackMessages = document.getElementById("feedback-messages");
        const logoutButton = document.getElementById("logout");

        // Fetch CSRF token and apply to all forms
        async function fetchCsrfToken() {
            try {
                const response = await fetch("/csrf-token", {
                    credentials: "include",
                });
                const data = await response.json();
                
                // Apply CSRF token to all forms
                document.getElementById("signup-csrf").value = data.csrfToken;
                document.getElementById("login-csrf").value = data.csrfToken;
                document.getElementById("feedback-csrf").value = data.csrfToken;
                
                return data.csrfToken;
            } catch (error) {
                console.error("Error fetching CSRF token:", error);
            }
        }

        // Initialize CSRF token
        fetchCsrfToken();

        // User Registration Handler
        signupForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("signup-email").value;
            const password = document.getElementById("signup-password").value;
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Save user to Firestore
                await setDoc(doc(db, "users", user.uid), { 
                    email: user.email,
                    createdAt: new Date()
                });
                
                alert("‚úÖ Signup Successful! You can now log in.");
                signupForm.reset();
            } catch (error) {
                console.error("Signup error:", error);
                alert("‚ö†Ô∏è " + error.message);
            }
        });

        // User Login Handler
        loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-password").value;
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                userEmailSpan.textContent = user.email;
                
                // Show dashboard, hide auth section
                authSection.style.display = "none";
                dashboard.style.display = "block";
                
                // Load user's feedback
                loadUserFeedback(user.uid);
            } catch (error) {
                console.error("Login error:", error);
                alert("‚ö†Ô∏è " + error.message);
            }
        });

        // Submit Feedback Handler
        feedbackForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const feedbackText = document.getElementById("feedback").value;
            const user = auth.currentUser;
            
            if (user) {
                try {
                    await addDoc(collection(db, "feedback"), {
                        userId: user.uid,
                        email: user.email,
                        feedback: feedbackText,
                        timestamp: new Date()
                    });
                    
                    alert("‚úÖ Feedback submitted successfully!");
                    feedbackForm.reset();
                    
                    // Reload feedback
                    loadUserFeedback(user.uid);
                } catch (error) {
                    console.error("Feedback submission error:", error);
                    alert("‚ö†Ô∏è " + error.message);
                }
            } else {
                alert("‚ö†Ô∏è You must be logged in to submit feedback.");
            }
        });

        // Load User Feedback from Firestore
        function loadUserFeedback(userId) {
            if (!db) {
                console.error("Firestore not initialized");
                return;
            }
            
            const q = query(
                collection(db, "feedback"), 
                where("userId", "==", userId), 
                orderBy("timestamp", "desc")
            );
            
            onSnapshot(q, (snapshot) => {
                feedbackMessages.innerHTML = "";
                
                if (snapshot.empty) {
                    feedbackMessages.innerHTML = "<p>No feedback submitted yet.</p>";
                } else {
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        const date = data.timestamp ? new Date(data.timestamp.toDate()).toLocaleString() : "Unknown date";
                        
                        // Sanitize feedback using DOMPurify
                        const sanitizedFeedback = DOMPurify.sanitize(data.feedback);
                        
                        feedbackMessages.innerHTML += `
                            <div class="feedback-item">
                                <p class="feedback-text">${sanitizedFeedback}</p>
                                <p class="feedback-date">${date}</p>
                            </div>
                        `;
                    });
                }
            });
        }

        // Logout Handler
        logoutButton.addEventListener("click", async () => {
            try {
                await signOut(auth);
                
                // Show auth section, hide dashboard
                authSection.style.display = "block";
                dashboard.style.display = "none";
                
                // Clear feedback messages
                feedbackMessages.innerHTML = "";
                
                alert("‚úÖ Logged out successfully!");
            } catch (error) {
                console.error("Logout error:", error);
                alert("‚ö†Ô∏è " + error.message);
            }
        });

        // Auth State Change Listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in
                userEmailSpan.textContent = user.email;
                authSection.style.display = "none";
                dashboard.style.display = "block";
                loadUserFeedback(user.uid);
            } else {
                // User is signed out
                authSection.style.display = "block";
                dashboard.style.display = "none";
            }
        });
    </script>

    <section class="intro">
        <h2>üåê Welcome Hackers & Builders!</h2>
        <p>üöÄ <strong>Hello Everyone!</strong> Welcome to the official landing page for <strong>Group Meshtacular</strong>!</p>
        <h3>üë• Our Team</h3>
        <ul>
            <li>üî• <strong>Sean Griffiths</strong></li>
            <li>üè¥‚Äç‚ò†Ô∏è <strong>Luca Maddaleni</strong></li>
            <li>üõ∏ <strong>Robert Stanley</strong></li>
        </ul>
    </section>

    <section class="about">
        <h2>üìå What is Meshtacular?</h2>
        <p>Meshtacular is a <strong>group of Undergrads at Georgia State University</strong> focused on developing <strong>secure, efficient, and innovative</strong> software. This website serves as:</p>
        <ul>
            <li>üìÇ A <strong>landing page</strong> for our group‚Äôs progress.</li>
            <li>üì° A hub for <strong>our networking-based projects</strong>.</li>
            <li>üõ† A place to <strong>document our coding journey</strong> and discoveries.</li>
        </ul>
    </section>

    <section class="roadmap">
        <h2>üèóÔ∏è Project 1 Roadmap</h2>
        <table>
            <tr>
                <th>Phase</th>
                <th>Task</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>üü¢</td>
                <td><strong>Setup GitHub Pages</strong></td>
                <td>‚úÖ Completed</td>
            </tr>
            <tr>
                <td>üü°</td>
                <td><strong>Implement Website Design</strong></td>
                <td>‚úÖ Completed</td>
            </tr>
            <tr>
                <td>üî¥</td>
                <td><strong>Develop Core Networking Features</strong></td>
                <td>‚úÖ Completed</td>
            </tr>
            <tr>
                <td>üü£</td>
                <td><strong>Optimize & Deploy</strong></td>
                <td>‚úÖ Completed</td>
            </tr>
        </table>
    </section>

    <section class="project-list">
        <h2>üöÄ Featured Projects</h2>
        <p>Check out our latest developments in networking and security.</p>
        <ul>
            <li><strong>Project 1:</strong> This Project Portfolio Website!</li>
            <li><strong>Project 2:</strong> Secure Communication with a Decentralized Mesh Messaging App **Coming Soon**</li>
            <li><strong>Project 3:</strong> TBA!</li>
        </ul>
    </section>

    <section class="security-notice">
        <h2>üîí Security & Networking Details</h2>
        <p>This website follows security best practices, including:</p>
        <ul>
            <li>‚úÖ <strong>DNS:</strong> Resolves the domain <code>group-meshtacular.web.app/</code> to an IP address.</li>
            <li>‚úÖ <strong>IP Address:</strong> Hosted on Firebase‚Äôs infrastructure (<code>199.36.158.100</code>).</li>
            <li>‚úÖ <strong>HTTPS:</strong> Secure encryption enabled using SSL.</li>
            <li>‚úÖ <strong>HTTP Protocol:</strong> Requests are served using HTTP/HTTPS.</li>
        </ul>
        <p>Check the üîí padlock in the address bar for a secure connection!</p>
    </section>

    <section class="technologies">
        <h2>üõ† Technologies Used</h2>
        <ul>
            <li>üåç <strong>HTML & CSS</strong> ‚Äì Structuring and styling the website.</li>
            <li>üé® <strong>Custom Dark UI</strong> ‚Äì A hacker-style aesthetic.</li>
            <li>üîß <strong>GitHub Pages</strong> ‚Äì Free hosting.</li>
            <li>üîê <strong>Cybersecurity Best Practices</strong> ‚Äì HTTPS, DNS, IP handling.</li>
        </ul>
    </section>

    <footer>
        <h2>üöÄ Stay Tuned!</h2>
        <p>üõ°Ô∏è As we develop this website, we‚Äôll continue to add <strong>new features, security enhancements, and networking tools</strong>. Stay tuned and follow our progress!</p>
        <p>üíª <em>Happy Hacking!</em> üï∂Ô∏è</p>
         <pre style="font-family: 'Fira Code', monospace; text-align: center; color: #6899ca; background-color: #161b22; padding: 20px; border-radius: 10px; margin-top: 20px; font-size: 5px;">
            .,,uod8B8bou,,.
            ..,uod8BBBBBBBBBBBBBBBBRPFT?l!i:.
       ,=m8BBBBBBBBBBBBBBBRPFT?!||||||||||||||
       !...:!TVBBBRPFT||||||||||!!^^""'   ||||
       !.......:!?|||||!!^^""'            ||||
       !.........||||                     ||||
       !.........||||  ##                 ||||
       !.........||||                     ||||
       !.........||||                     ||||
       !.........||||                     ||||
       !.........||||                     ||||
       `.........||||                    ,||||
        .;.......||||               _.-!!|||||
 .,uodWBBBBb.....||||       _.-!!|||||||||!:'
!YBBBBBBBBBBBBBBb..!|||:..-!!|||||||!iof68BBBBBb....
!..YBBBBBBBBBBBBBBb!!||||||||!iof68BBBBBBRPFT?!::   `.
!....YBBBBBBBBBBBBBBbaaitf68BBBBBBRPFT?!:::::::::     `.
!......YBBBBBBBBBBBBBBBBBBBRPFT?!::::::;:!^"`;:::       `.
!........YBBBBBBBBBBRPFT?!::::::::::^''...::::::;         iBBbo.
`..........YBRPFT?!::::::::::::::::::::::::;iof68bo.      WBBBBbo.
`..........:::::::::::::::::::::::;iof688888888888b.     `YBBBP^'
  `........::::::::::::::::;iof688888888888888888888b.     `
    `......:::::::::;iof688888888888888888888888888888b.
      `....:::;iof688888888888888888888888888888888899fT!
        `..::!8888888888888888888888888888888899fT|!^"'
          `' !!988888888888888888888888899fT|!^"'
              `!!8888888888888888899fT|!^"'
                `!988888888899fT|!^"'
                  `!9899fT|!^"'
                    `!^"'
         </pre>
    </footer>

</body>
</html>



