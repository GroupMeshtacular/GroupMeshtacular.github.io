<!--Website born on 01-30-25
Initiated by Robert Stanley
Co-Authored by Luca Maddaleni & Sean Griffiths for Group Meshtacular in Computer Networks
Spring Semester 2025-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Meshtacular Project Website</title>
    <link rel="stylesheet" href="style.css">
    <!--sanitize content before display using DOMPurify-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.3/purify.min.js"></script> 
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        //Firebase Configuration
        const firebaseConfig = {
            apiKey: process.env.FIREBASE_API_KEY,
            authDomain: process.env.FIREBASE_AUTH_DOMAIN,
            projectId: process.env.FIREBASE_PROJECT_ID,
            storageBucket: process.env.FIREBASE_STORAGE_BUCKET,
            messagingSenderId: process.env.FIREBASE_MESSAGING_SENDER_ID,
            appId: process.env.FIREBASE_APP_ID
        };


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);

        // User Registration
        document.getElementById("signup-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const email = document.getElementById("signup-email").value;
            const password = document.getElementById("signup-password").value;
            createUserWithEmailAndPassword(auth, email, password)
                .then(async (userCredential) => {
                    const user = userCredential.user;
                    await setDoc(doc(db, "users", user.uid), { email: user.email });
                    alert("Signup Successful! You can now log in.");
                })
                .catch(error => alert(error.message));
        });

        // User Login
        document.getElementById("login-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-password").value;
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    alert(`Welcome back, ${user.email}!`);
                    document.getElementById("auth-section").style.display = "none";
                    document.getElementById("dashboard").style.display = "block";
                })
                .catch(error => alert(error.message));
        });

        // User Logout
        document.getElementById("logout").addEventListener("click", () => {
            signOut(auth).then(() => {
                alert("Logged out successfully!");
                document.getElementById("auth-section").style.display = "block";
                document.getElementById("dashboard").style.display = "none";
            });
        });

    </script>
</head>
<body>
    <header>
        <h1>ğŸ•¶ï¸ Welcome to Group Meshtacular</h1>
        <p>ğŸ“Ÿ The Cyber HQ for Our Networking & Security Portfolio</p>
    </header>

    <!-- Authentication Section -->
    <div id="auth-section">
        <h2>Sign Up</h2>
        <form id="signup-form">
            <input type="email" id="signup-email" placeholder="Email" required>
            <input type="password" id="signup-password" placeholder="Password" required>
            <button type="submit">Sign Up</button>
        </form>

        <h2>Login</h2>
        <form id="login-form">
            <input type="email" id="login-email" placeholder="Email" required>
            <input type="password" id="login-password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
    </div>

    <!-- Dashboard (Only visible after login) -->
    <div id="dashboard" style="display:none;">
        <h2>Dashboard</h2>
        <p>Welcome, <span id="user-email"></span>! You are now logged in.</p>
        
        <h3>Your Feedback</h3>
        <div id="feedback-messages"></div>

        <button id="logout">Logout</button>
    </div>

    <!-- Feedback Form (Users Must Be Logged In to Submit) -->
    <form id="feedback-form">
        <label for="feedback">Your Feedback:</label>
        <textarea id="feedback" name="feedback" required></textarea>
        <button type="submit">Submit Feedback</button>
    </form>

    <!-- Feedback Messages (Only Shows Logged-in User's Feedback) -->
    <h3>Your Submitted Feedback</h3>
    <div id="feedback-messages"></div>

    <div id="feedback-container">
        <h2>Your Feedback</h2>
        <ul id="feedback-list"></ul>
    </div>

    <!-- Firebase Feedback Handling -->
    <script type="module">
        import { getFirestore, collection, addDoc, query, orderBy, where, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const auth = getAuth();
        const db = getFirestore();

        const feedbackForm = document.getElementById("feedback-form");
        const feedbackMessages = document.getElementById("feedback-messages");


        async function getCsrfToken() {
            const response = await fetch("http://localhost:3000/csrf-token", {
                credentials: "include",
            });
            const data = await response.json();
            return data.csrfToken;
        }        

        // Submit Feedback to Firestore (Only for Logged-In Users)
        feedbackForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const feedbackText = document.getElementById("feedback").value;
            const user = auth.currentUser;

            if (user) {
                try {
                    await addDoc(collection(db, "feedback"), {
                        userId: user.uid,
                        email: user.email,
                        feedback: feedbackText,
                        timestamp: new Date()
                    });

                    alert("âœ… Feedback submitted!");
                    feedbackForm.reset();
                    loadUserFeedback(user.uid);
                } catch (error) {
                    alert("âš ï¸ Error submitting feedback: " + error.message);
                }
            } else {
                alert("âš ï¸ You must be logged in to submit feedback.");
            }
        });

        // Load Only User-Specific Feedback
        function loadUserFeedback(userId) {
            const q = query(collection(db, "feedback"), where("userId", "==", userId), orderBy("timestamp", "desc"));
            
            onSnapshot(q, (snapshot) => {
                feedbackMessages.innerHTML = "";
                if (snapshot.empty) {
                    feedbackMessages.innerHTML = "<p>No feedback submitted yet.</p>";
                } else {
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        feedbackMessages.innerHTML += `<p><strong>${data.email}:</strong> ${data.feedback}</p>`;
                    });
                }
            });
        }

        // Detect Authentication State & Load Feedback
        onAuthStateChanged(auth, (user) => {
            if (user) {
                loadUserFeedback(user.uid);
            } else {
                feedbackMessages.innerHTML = "<p>âš ï¸ Please log in to view your feedback.</p>";
            }
        });

        // Fetch CSRF token from server and insert it into the form
        fetch('/csrf-token')
            .then(response => response.json())
            .then(data => {
                document.getElementById("csrf-token").value = data.csrfToken;
            })
            .catch(error => console.error("Error fetching CSRF token:", error));
    </script>

    <section class="intro">
        <h2>ğŸŒ Welcome Hackers & Builders!</h2>
        <p>ğŸš€ <strong>Hello Everyone!</strong> Welcome to the official landing page for <strong>Group Meshtacular</strong>!</p>
        <h3>ğŸ‘¥ Our Team</h3>
        <ul>
            <li>ğŸ”¥ <strong>Sean Griffiths</strong></li>
            <li>ğŸ´â€â˜ ï¸ <strong>Luca Maddaleni</strong></li>
            <li>ğŸ›¸ <strong>Robert Stanley</strong></li>
        </ul>
    </section>

    <section class="about">
        <h2>ğŸ“Œ What is Meshtacular?</h2>
        <p>Meshtacular is a <strong>group of Undergrads at Georgia State University</strong> focused on developing <strong>secure, efficient, and innovative</strong> software. This website serves as:</p>
        <ul>
            <li>ğŸ“‚ A <strong>landing page</strong> for our groupâ€™s progress.</li>
            <li>ğŸ“¡ A hub for <strong>our networking-based projects</strong>.</li>
            <li>ğŸ›  A place to <strong>document our coding journey</strong> and discoveries.</li>
        </ul>
    </section>

    <section class="roadmap">
        <h2>ğŸ—ï¸ Project 1 Roadmap</h2>
        <table>
            <tr>
                <th>Phase</th>
                <th>Task</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>ğŸŸ¢</td>
                <td><strong>Setup GitHub Pages</strong></td>
                <td>âœ… Completed</td>
            </tr>
            <tr>
                <td>ğŸŸ¡</td>
                <td><strong>Implement Website Design</strong></td>
                <td>âœ… Completed</td>
            </tr>
            <tr>
                <td>ğŸ”´</td>
                <td><strong>Develop Core Networking Features</strong></td>
                <td>âœ… Completed</td>
            </tr>
            <tr>
                <td>ğŸŸ£</td>
                <td><strong>Optimize & Deploy</strong></td>
                <td>âœ… Completed</td>
            </tr>
        </table>
    </section>

    <section class="project-list">
        <h2>ğŸš€ Featured Projects</h2>
        <p>Check out our latest developments in networking and security.</p>
        <ul>
            <li><strong>Project 1:</strong> This Project Portfolio Website!</li>
            <li><strong>Project 2:</strong> Secure Communication with a Decentralized Mesh Messaging App **Coming Soon**</li>
            <li><strong>Project 3:</strong> TBA!</li>
        </ul>
    </section>

    <section class="security-notice">
        <h2>ğŸ”’ Security & Networking Details</h2>
        <p>This website follows security best practices, including:</p>
        <ul>
            <li>âœ… <strong>DNS:</strong> Resolves the domain <code>groupmeshtacular.github.io</code> to an IP address.</li>
            <li>âœ… <strong>IP Address:</strong> Hosted on GitHubâ€™s infrastructure (<code>185.199.108.153</code>).</li>
            <li>âœ… <strong>HTTPS:</strong> Secure encryption enabled using SSL.</li>
            <li>âœ… <strong>HTTP Protocol:</strong> Requests are served using HTTP/HTTPS.</li>
        </ul>
        <p>Check the ğŸ”’ padlock in the address bar for a secure connection!</p>
    </section>

    <section class="technologies">
        <h2>ğŸ›  Technologies Used</h2>
        <ul>
            <li>ğŸŒ <strong>HTML & CSS</strong> â€“ Structuring and styling the website.</li>
            <li>ğŸ¨ <strong>Custom Dark UI</strong> â€“ A hacker-style aesthetic.</li>
            <li>ğŸ”§ <strong>GitHub Pages</strong> â€“ Free hosting.</li>
            <li>ğŸ” <strong>Cybersecurity Best Practices</strong> â€“ HTTPS, DNS, IP handling.</li>
        </ul>
    </section>

    <footer>
        <h2>ğŸš€ Stay Tuned!</h2>
        <p>ğŸ›¡ï¸ As we develop this website, weâ€™ll continue to add <strong>new features, security enhancements, and networking tools</strong>. Stay tuned and follow our progress!</p>
        <p>ğŸ’» <em>Happy Hacking!</em> ğŸ•¶ï¸</p>
         <pre style="font-family: 'Fira Code', monospace; text-align: center; color: #6899ca; background-color: #161b22; padding: 20px; border-radius: 10px; margin-top: 20px; font-size: 5px;">
            .,,uod8B8bou,,.
            ..,uod8BBBBBBBBBBBBBBBBRPFT?l!i:.
       ,=m8BBBBBBBBBBBBBBBRPFT?!||||||||||||||
       !...:!TVBBBRPFT||||||||||!!^^""'   ||||
       !.......:!?|||||!!^^""'            ||||
       !.........||||                     ||||
       !.........||||  ##                 ||||
       !.........||||                     ||||
       !.........||||                     ||||
       !.........||||                     ||||
       !.........||||                     ||||
       `.........||||                    ,||||
        .;.......||||               _.-!!|||||
 .,uodWBBBBb.....||||       _.-!!|||||||||!:'
!YBBBBBBBBBBBBBBb..!|||:..-!!|||||||!iof68BBBBBb....
!..YBBBBBBBBBBBBBBb!!||||||||!iof68BBBBBBRPFT?!::   `.
!....YBBBBBBBBBBBBBBbaaitf68BBBBBBRPFT?!:::::::::     `.
!......YBBBBBBBBBBBBBBBBBBBRPFT?!::::::;:!^"`;:::       `.
!........YBBBBBBBBBBRPFT?!::::::::::^''...::::::;         iBBbo.
`..........YBRPFT?!::::::::::::::::::::::::;iof68bo.      WBBBBbo.
`..........:::::::::::::::::::::::;iof688888888888b.     `YBBBP^'
  `........::::::::::::::::;iof688888888888888888888b.     `
    `......:::::::::;iof688888888888888888888888888888b.
      `....:::;iof688888888888888888888888888888888899fT!
        `..::!8888888888888888888888888888888899fT|!^"'
          `' !!988888888888888888888888899fT|!^"'
              `!!8888888888888888899fT|!^"'
                `!988888888899fT|!^"'
                  `!9899fT|!^"'
                    `!^"'
         </pre>
    </footer>

</body>
</html>
